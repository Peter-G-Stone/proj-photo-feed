{"ast":null,"code":"import { API_URL } from './apiUrl';\nimport * as types from './actionTypes';\n\nvar authRequest = function authRequest() {\n  return {\n    type: types.AUTHENTICATION_REQUEST\n  };\n};\n\nvar authSuccess = function authSuccess(user, token) {\n  return {\n    type: types.AUTHENTICATION_SUCCESS,\n    user: user,\n    token: token\n  };\n};\n\nvar authFailure = function authFailure(errors) {\n  return {\n    type: types.AUTHENTICATION_FAILURE,\n    errors: errors\n  };\n};\n\nexport var logout = function logout() {\n  return function (dispatch) {\n    localStorage.clear();\n    return dispatch({\n      type: types.LOGOUT\n    });\n  };\n};\nexport var signup = function signup(user, history) {\n  var newUser = user;\n  return function (dispatch) {\n    return fetch(\"\".concat(API_URL, \"/users\"), {\n      method: \"POST\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        user: user\n      })\n    }).then(function (response) {\n      debugger;\n      return response.json();\n    }).then(function (jresp) {\n      debugger;\n\n      if (jresp.ok) {\n        dispatch(authenticate({\n          email: newUser.email,\n          password: newUser.password\n        }, history));\n      } else if (jresp.email || jresp.username) {\n        var alertMsg = 'Your choice is not available for: ';\n        jresp.email ? alertMsg += 'email' : null;\n        jresp.email && jresp.username ? alertMsg += ' and ' : null;\n        jresp.username ? alertMsg += 'username' : null;\n      }\n    }).catch(function (errors) {\n      window.alert(\"Sorry, something went wrong. Please try again.\");\n      dispatch(authFailure(errors));\n    });\n  };\n};\nexport var authenticate = function authenticate(credentials, history) {\n  return function (dispatch) {\n    dispatch(authRequest());\n    return fetch(\"\".concat(API_URL, \"/user_token\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        auth: credentials\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (response) {\n      var token = response.jwt;\n      localStorage.setItem('token', token);\n      history.push('/');\n      window.alert('You are now logged in!');\n      return getUser(credentials);\n    }).then(function (user) {\n      console.log(user);\n      dispatch(authSuccess(user, localStorage.token));\n    }).catch(function (errors) {\n      window.alert(\"Sorry, something went wrong. Please try logging in again.\");\n      dispatch(authFailure(errors));\n      localStorage.clear();\n    });\n  };\n}; // this getUser is called by authenticate, it is not an action in and of itself currently (because it doesn't return a dispatch call):\n\nexport var getUser = function getUser(credentials) {\n  var request = new Request(\"\".concat(API_URL, \"/find_user\"), {\n    method: \"POST\",\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": \"Bearer \".concat(localStorage.token)\n    }),\n    body: JSON.stringify({\n      user: credentials\n    })\n  });\n  return fetch(request).then(function (response) {\n    return response.json();\n  }).then(function (userJson) {\n    return userJson;\n  }).catch(function (error) {\n    return error;\n  });\n};","map":{"version":3,"sources":["/Users/peter/Development/code/proj-photo-feed/photo-feed-react/src/actions/authActions.js"],"names":["API_URL","types","authRequest","type","AUTHENTICATION_REQUEST","authSuccess","user","token","AUTHENTICATION_SUCCESS","authFailure","errors","AUTHENTICATION_FAILURE","logout","dispatch","localStorage","clear","LOGOUT","signup","history","newUser","fetch","method","headers","body","JSON","stringify","then","response","json","jresp","ok","authenticate","email","password","username","alertMsg","catch","window","alert","credentials","auth","res","jwt","setItem","push","getUser","console","log","request","Request","Headers","userJson","error"],"mappings":"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","sourcesContent":["import { API_URL } from './apiUrl'\nimport * as types from './actionTypes'\n\nconst authRequest = () => {\n  return {\n    type: types.AUTHENTICATION_REQUEST\n  }\n}\n\nconst authSuccess = (user, token) => {\n  return {\n    type: types.AUTHENTICATION_SUCCESS,\n    user: user,\n    token: token\n  }\n}\n\nconst authFailure = (errors) => {\n  return {\n    type: types.AUTHENTICATION_FAILURE,\n    errors: errors\n  }\n}\n\nexport const logout = () => {\n  return dispatch => {\n    localStorage.clear();\n    return dispatch({\n      type: types.LOGOUT\n    });\n  }\n}\n\nexport const signup = (user, history) => {\n  const newUser = user\n  return dispatch => {\n    return fetch(`${API_URL}/users`, {\n      method: \"POST\",\n      headers: {\n        \"Accept\":\"application/json\",\n        \"Content-Type\":\"application/json\"\n      },\n      body: JSON.stringify({user: user})\n    })\n      .then(response => {\n        debugger  \n        return response.json()})\n      .then(jresp => {\n        \n        debugger\n        if (jresp.ok){\n            dispatch(authenticate({\n              email: newUser.email,\n              password: newUser.password},\n              history)\n            );\n        }\n        else if (jresp.email || jresp.username) {\n            let alertMsg = 'Your choice is not available for: '\n            jresp.email ? alertMsg += 'email' : null\n            jresp.email && jresp.username ? alertMsg += ' and ' : null\n            jresp.username ? alertMsg += 'username' : null\n\n        }\n      })\n      .catch((errors) => {\n        window.alert(\"Sorry, something went wrong. Please try again.\") \n        dispatch(authFailure(errors))\n      })\n  };\n}\n\nexport const authenticate = (credentials, history) => {\n    return dispatch => {\n    dispatch(authRequest())\n    return fetch(`${API_URL}/user_token`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({auth: credentials})\n    })\n      .then(res => res.json())\n      .then((response) => {\n          const token = response.jwt;\n          localStorage.setItem('token', token);\n          history.push('/')\n          window.alert('You are now logged in!')\n          return getUser(credentials)\n      })\n      .then((user) => {\n        console.log(user)\n          dispatch(authSuccess(user, localStorage.token))\n      })\n      .catch((errors) => {\n          window.alert(\"Sorry, something went wrong. Please try logging in again.\")\n          dispatch(authFailure(errors))\n          localStorage.clear()\n      })\n  }\n}\n\n// this getUser is called by authenticate, it is not an action in and of itself currently (because it doesn't return a dispatch call):\nexport const getUser = (credentials) => {\n  const request = new Request(`${API_URL}/find_user`, {\n    method: \"POST\",\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${localStorage.token}`,\n    }),\n    body: JSON.stringify({user: credentials})\n  })\n  return fetch(request)\n    .then(response => response.json())\n    .then(userJson => {\n        return userJson})\n    .catch(error => {\n      return error;\n    });\n}\n"]},"metadata":{},"sourceType":"module"}