{"ast":null,"code":"import { API_URL } from './apiUrl';\nimport * as types from './actionTypes';\n\nvar authRequest = function authRequest() {\n  return {\n    type: types.AUTHENTICATION_REQUEST\n  };\n};\n\nvar authSuccess = function authSuccess(user, token) {\n  return {\n    type: types.AUTHENTICATION_SUCCESS,\n    user: user,\n    token: token\n  };\n};\n\nvar authFailure = function authFailure(errors) {\n  return {\n    type: types.AUTHENTICATION_FAILURE,\n    errors: errors\n  };\n};\n\nexport var logout = function logout() {\n  return function (dispatch) {\n    localStorage.clear();\n    return dispatch({\n      type: types.LOGOUT\n    });\n  };\n};\nexport var findUserWithToken = function findUserWithToken() {\n  return function (dispatch) {\n    return fetch('http://localhost:3001/api/find_user_with_token', {\n      method: \"POST\",\n      headers: new Headers({\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \".concat(localStorage.token)\n      }),\n      body: JSON.stringify({\n        token: localStorage.token\n      })\n    }).then(function (resp) {\n      return resp.json();\n    }).then(function (userJson) {\n      dispatch(authSuccess(userJson, localStorage.token));\n    });\n  };\n};\nexport var signup = function signup(user, history) {\n  var newUser = user;\n  return function (dispatch) {\n    return fetch(\"\".concat(API_URL, \"/users\"), {\n      method: \"POST\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        user: user\n      })\n    }).then(function (response) {\n      return response.json();\n    }).then(function (jresp) {\n      if (jresp.id) {\n        //dispatch to authenticate if user was successfully created\n        dispatch(authenticate({\n          email: newUser.email,\n          password: newUser.password\n        }, history));\n      } else if (jresp.email || jresp.username) {\n        // this handles if email or password already taken\n        fireSignUpAlertMsg(jresp);\n      }\n    }).catch(function (errors) {\n      debugger;\n      window.alert(\"Sorry, something went wrong. Please try again.\");\n      dispatch(authFailure(errors));\n    });\n  };\n};\nexport var authenticate = function authenticate(credentials, history) {\n  return function (dispatch) {\n    dispatch(authRequest());\n    return fetch(\"\".concat(API_URL, \"/user_token\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        auth: credentials\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (response) {\n      var token = response.jwt;\n      localStorage.setItem('token', token);\n      history.push('/');\n      window.alert('You are now logged in!');\n      return getUser(credentials);\n    }).then(function (user) {\n      console.log(user);\n      dispatch(authSuccess(user, localStorage.token));\n    }).catch(function (errors) {\n      window.alert(\"Sorry, something went wrong. Please try logging in again.\");\n      dispatch(authFailure(errors));\n      localStorage.clear();\n    });\n  };\n}; // this getUser is called by authenticate, it is not an action in and of itself currently (because it doesn't return a dispatch call):\n\nexport var getUser = function getUser(credentials) {\n  var request = new Request(\"\".concat(API_URL, \"/find_user\"), {\n    method: \"POST\",\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": \"Bearer \".concat(localStorage.token)\n    }),\n    body: JSON.stringify({\n      user: credentials\n    })\n  });\n  return fetch(request).then(function (response) {\n    return response.json();\n  }).then(function (userJson) {\n    return userJson;\n  }).catch(function (error) {\n    return error;\n  });\n};\n\nvar fireSignUpAlertMsg = function fireSignUpAlertMsg(jresp) {\n  var alertMsg = 'Another account is already using that ';\n  alertMsg = jresp.email ? alertMsg += 'email' : alertMsg;\n  alertMsg = jresp.email && jresp.username ? alertMsg += ' and ' : alertMsg;\n  alertMsg = jresp.username ? alertMsg += 'username' : alertMsg;\n  alertMsg += '.';\n  window.alert(alertMsg);\n};","map":{"version":3,"sources":["/Users/peter/Development/code/proj-photo-feed/photo-feed-react/src/actions/authActions.js"],"names":["API_URL","types","authRequest","type","AUTHENTICATION_REQUEST","authSuccess","user","token","AUTHENTICATION_SUCCESS","authFailure","errors","AUTHENTICATION_FAILURE","logout","dispatch","localStorage","clear","LOGOUT","findUserWithToken","fetch","method","headers","Headers","body","JSON","stringify","then","resp","json","userJson","signup","history","newUser","response","jresp","id","authenticate","email","password","username","fireSignUpAlertMsg","catch","window","alert","credentials","auth","res","jwt","setItem","push","getUser","console","log","request","Request","error","alertMsg"],"mappings":"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","sourcesContent":["import { API_URL } from './apiUrl'\nimport * as types from './actionTypes'\n\nconst authRequest = () => {\n  return {\n    type: types.AUTHENTICATION_REQUEST\n  }\n}\n\nconst authSuccess = (user, token) => {\n  return {\n    type: types.AUTHENTICATION_SUCCESS,\n    user: user,\n    token: token\n  }\n}\n\nconst authFailure = (errors) => {\n  return {\n    type: types.AUTHENTICATION_FAILURE,\n    errors: errors\n  }\n}\n\nexport const logout = () => {\n  return dispatch => {\n    localStorage.clear();\n    return dispatch({\n      type: types.LOGOUT\n    });\n  }\n}\n\nexport const findUserWithToken = () => {\n  return dispatch => {\n    return fetch('http://localhost:3001/api/find_user_with_token', {\n          method: \"POST\",\n          headers: new Headers({\n            \"Content-Type\": \"application/json\",\n            \"Authorization\": `Bearer ${localStorage.token}`,\n          }),\n          body: JSON.stringify({token: localStorage.token})\n        })\n        .then(resp => resp.json())\n        .then(userJson => {\n          dispatch(authSuccess(userJson, localStorage.token))          \n    })\n  }\n}\n\nexport const signup = (user, history) => {\n  const newUser = user\n  return dispatch => {\n    return fetch(`${API_URL}/users`, {\n      method: \"POST\",\n      headers: {\n        \"Accept\":\"application/json\",\n        \"Content-Type\":\"application/json\"\n      },\n      body: JSON.stringify({user: user})\n    })\n      .then(response => {\n        return response.json()})\n      .then(jresp => {\n        \n        if (jresp.id){ //dispatch to authenticate if user was successfully created\n            dispatch(authenticate({\n              email: newUser.email,\n              password: newUser.password},\n              history)\n            );\n        }\n        else if (jresp.email || jresp.username) { \n          // this handles if email or password already taken\n            fireSignUpAlertMsg(jresp)\n        }\n      })\n      .catch((errors) => {\n          debugger\n        window.alert(\"Sorry, something went wrong. Please try again.\") \n        dispatch(authFailure(errors))\n      })\n  };\n}\n\nexport const authenticate = (credentials, history) => {\n    return dispatch => {\n    dispatch(authRequest())\n    return fetch(`${API_URL}/user_token`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({auth: credentials})\n    })\n      .then(res => res.json())\n      .then((response) => {\n          const token = response.jwt;\n          localStorage.setItem('token', token);\n          history.push('/')\n          window.alert('You are now logged in!')\n          return getUser(credentials)\n      })\n      .then((user) => {\n        console.log(user)\n          dispatch(authSuccess(user, localStorage.token))\n      })\n      .catch((errors) => {\n          window.alert(\"Sorry, something went wrong. Please try logging in again.\")\n          dispatch(authFailure(errors))\n          localStorage.clear()\n      })\n  }\n}\n\n// this getUser is called by authenticate, it is not an action in and of itself currently (because it doesn't return a dispatch call):\nexport const getUser = (credentials) => {\n  const request = new Request(`${API_URL}/find_user`, {\n    method: \"POST\",\n    headers: new Headers({\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": `Bearer ${localStorage.token}`,\n    }),\n    body: JSON.stringify({user: credentials})\n  })\n  return fetch(request)\n    .then(response => response.json())\n    .then(userJson => {\n        return userJson})\n    .catch(error => {\n      return error;\n    });\n}\n\nconst fireSignUpAlertMsg = (jresp) => {\n    let alertMsg = 'Another account is already using that '\n    alertMsg = jresp.email ? alertMsg += 'email' : alertMsg\n    alertMsg = (jresp.email && jresp.username) ? alertMsg += ' and ' : alertMsg\n    alertMsg = jresp.username ? alertMsg += 'username' : alertMsg\n    alertMsg += '.'\n    window.alert(alertMsg)\n}"]},"metadata":{},"sourceType":"module"}